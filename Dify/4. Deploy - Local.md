<div align="center">
  
# 🚀 本地部屬（Docker Compose）

</div>

## 1. 前置準備

### **系統要求：**
- CPU >= 2 核心
- RAM >= 4GB
- 硬碟空間 >= 10GB

### **安裝 Docker 和 Docker Compose：**

**Windows/Mac:**
```bash
# 下載並安裝 Docker Desktop（AMD64 版本）
# https://www.docker.com/products/docker-desktop
```
## 2. 下載 Dify

```bash
# 克隆倉庫
git clone https://github.com/langgenius/dify.git

# 進入目錄
cd dify/docker
```

## 3. 配置環境變數（暫且不理會）

```bash
# 複製環境變數模板
cp .env.example .env
# 如果出錯誤，也可能是 copy
copy .env.example .env

# 編輯 .env 文件（可選）
nano .env
```

**重要配置項：（暫且不理會）**
```bash
# .env 文件關鍵設置

# 密鑰（建議修改）
SECRET_KEY=your-secret-key-here

# 資料庫
DB_USERNAME=postgres
DB_PASSWORD=difyai123456

# Redis
REDIS_PASSWORD=difyai123456

# 模式（默認即可）
MODE=production

# 語言
LANGUAGE=zh-Hans

# API URL（如果需要外部訪問）
CONSOLE_API_URL=http://localhost:80
SERVICE_API_URL=http://localhost:80
```

## 4. 啟動服務

```bash
# 啟動所有服務
docker compose up -d

# 查看服務狀態
docker compose ps

# 查看日誌
docker compose logs -f
```

## 5. 訪問 Dify

打開瀏覽器訪問：
- **主控台：** http://localhost/install
- **API 文檔：** http://localhost/api/docs

首次訪問會進入初始化頁面，設置管理員賬號。

## 6. 常用管理命令

```bash
# 停止服務
docker compose down

# 重啟服務
docker compose restart

# 更新 Dify
git pull
docker compose down
docker compose pull
docker compose up -d

# 查看日誌
docker compose logs -f api
docker compose logs -f worker

# 清理並重新部署（⚠️ 會刪除數據）
docker compose down -v
docker compose up -d
```

## 配置 LLM 模型

**本地模型（Ollama）：**
```bash
# 安裝 Ollama
curl -fsSL https://ollama.com/install.sh | sh

# 下載模型
ollama pull llama2

# Dify 中配置
# 模型供應商 → Ollama
# Base URL: http://host.docker.internal:11434
```
---

<div align="center">
  
# ✨ 重新部署與設定

</div>

## 完全重置（推薦，會清除所有數據）

```bash
# 在 PowerShell 中執行（以管理員身份運行）

# 進入 dify/docker 目錄
cd dify/docker

# 停止並刪除所有容器和數據卷
docker compose down -v

# 列出並刪除 dify 相關的 volumes
docker volume ls
docker volume prune -f

# 重新啟動
docker compose up -d

# 等待服務啟動
timeout /t 30

# 查看服務狀態
docker compose ps
```

然後再訪問 http://localhost/install

<div align="center">
  
# ✨ 重新設定（管理員）密碼

</div>

Dify 的重設密碼功能是**互動式**的，它希望你執行指令後，再依照它的詢問一步一步輸入。

請依照以下步驟修正操作：

### 正確的操作步驟

1.  **只輸入前面的指令** (拿掉帳號密碼)：
    ```cmd
    docker exec -it docker-api-1 flask reset-password
    ```

2.  按下 **Enter** 後，系統會跳出提示，請依照順序輸入：

    *   **出現 `Email:` 時**：
        輸入，然後按 **Enter**。

    *   **出現 `New password:` 時**：
        輸入，後按 **Enter**。
        ⚠️ **重要注意**：在 Linux/Docker 終端機輸入密碼時，**畫面上不會出現任何星星或圓點，游標也不會動**，這是正常的安全機制。請放心地把密碼打完，然後按 Enter。

    *   **出現 `Password confirm:` 時**：
        再次輸入，然後按 **Enter**。

這樣就會顯示密碼重設成功了，接著你就可以去網頁登入了。

<div align="center">
  
# ✨ 關掉插件驗證

</div>

是的，在本地端（自託管）版本可以關閉插件驗證。根據搜尋結果，有以下方法：

## 具體步驟：

### 1. 找到 .env 檔案位置
- 如果使用 Docker 部署，檔案通常在 `/docker/.env`
- 也可能在 Dify 安裝目錄的根目錄

### 2. 編輯檔案
```
FORCE_VERIFYING_SIGNATURE=false
ENFORCE_LANGGENIUS_PLUGIN_SIGNATURES=false
```

### 4. 重新啟動服務
```bash
# 如果使用 docker-compose
docker-compose down
docker-compose up -d
```

## 注意事項

1. **重啟必要**：修改 .env 後必須重啟相關服務才會生效
